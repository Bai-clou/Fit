{"version":3,"sources":[null,"webpack:///C:/documents/javaprojects/Fit/uniapp/components/sportmap.vue?50c1","webpack:///C:/documents/javaprojects/Fit/uniapp/components/sportmap.vue?58e3","webpack:///C:/documents/javaprojects/Fit/uniapp/components/sportmap.vue?486a","uni-app:///components/sportmap.vue"],"names":["name","props","sporticon","type","default","sporttitle","data","latitude","longitude","markers","id","iconPath","width","height","polyline","points","color","arrowLine","timer","lastLocation","currentLocation","distance","mounted","uni","success","console","that","fail","methods","calculateDistance","Math","s","startDrawingPath","updateDistance","endSport","stopDrawingPath","clearInterval"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqH;AACrH;AAC4D;AACL;;;AAGvD;AACyL;AACzL,gBAAgB,gMAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,mFAAM;AACR,EAAE,4FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,uFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAmtB,CAAgB,itBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCevuB;EACAA;EACAC;IACAC;MACAC;MACAC;IACA;IACAC;MACAF;MACAC;IACA;EAEA;EACAE;IACA;MACAC;MACAC;MACAC;QACAC;QACAF;QACAD;QACAI;QACAC;QACAC;MACA,GACA;QACAH;QACAF;QACAD;QACAI;QACAC;QACAC;MACA;MAAA;MACAC;QACAC;QACAC;QACAJ;QACAK;MACA;MAAA;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACAC;MACApB;MACAqB;QACAC;QACAA;QACAA;QACAC;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;UAAAlB;UAAAD;QAAA;QACAmB;UAAAlB;UAAAD;QAAA;MACA;MAAAoB;QACAF;MACA;IACA;EACA;EACAG;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA,+DACAC;MACAC;MACA;IACA;IACA;IACAC;MACA;MACAP;MACA;QACA;QACAF;UACApB;UACAqB;YACA;YACAE;YACAA;YACAA;YACAA;YACA;cACAlB;cACAD;YACA;YACA;YACAmB;YACAA;cAAAlB;cAAAD;YAAA;YACAmB;YACA;YACApB;YACAA;YACAoB;UACA;QACA;MACA;IACA;IACAO;MACA;QACA;QACA;MACA;MACA;QAAAzB;QAAAD;MAAA;IACA;IACA2B;MACA;MACA;MACA;MACA5B;MACAA;MACA;IACA;IACA6B;MACAC;IACA;EACA;AACA;AAAA,2B","file":"components/sportmap.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./sportmap.vue?vue&type=template&id=6f25d9a3&\"\nvar renderjs\nimport script from \"./sportmap.vue?vue&type=script&lang=js&\"\nexport * from \"./sportmap.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/sportmap.vue\"\nexport default component.exports","export * from \"-!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./sportmap.vue?vue&type=template&id=6f25d9a3&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./sportmap.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../programs/HbuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./sportmap.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<view style=\"height: 60rpx;width: 250rpx;margin: 20rpx;display: flex;flex-direction: row;align-items: center;position: fixed;z-index: 99;\">\r\n\t\t\t<image :src=\"sporticon\" style=\"height: 50rpx;width: 50rpx;\"></image>\r\n\t\t\t<text style=\"font-size: 35rpx;font-weight: bold;margin-left: 10rpx;\">{{sporttitle}}</text>\r\n\t\t</view>\n\t\t<view class=\"page-body\">\r\n\t\t\t<map :scale=\"18\" style=\"width: 100vw; height: 100vh;position: fixed;\" \r\n\t\t\t:latitude=\"latitude\" :longitude=\"longitude\" :markers=\"markers\" :polyline=\"polyline\"\r\n\t\t\t@markertap=\"onMarkerTap\" @markertouchmove=\"onMarkerTouchMove\"></map>\r\n\t\t</view>\r\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tname:\"sportmap\",\r\n\t\tprops:{\r\n\t\t\tsporticon:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\tdefault:'../static/icons/walk.png'\r\n\t\t\t},\r\n\t\t\tsporttitle:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\tdefault:'户外行走'\r\n\t\t\t},\r\n\t\t\t\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tlatitude: '',\r\n\t\t\t\tlongitude: '',\r\n\t\t\t\tmarkers: [{ \n\t\t\t\t\tid: 0,\n\t\t\t\t\tlongitude: '120.2826', \n\t\t\t\t\tlatitude: '36.722',\r\n\t\t\t\t\ticonPath: '../static/icons/start.png',\r\n\t\t\t\t\twidth: 50,\r\n\t\t\t\t\theight: 50,\n\t\t\t\t},\r\n\t\t\t\t{ \r\n\t\t\t\t\tid: 1,\r\n\t\t\t\t\tlongitude: '', \r\n\t\t\t\t\tlatitude: '', \r\n\t\t\t\t\ticonPath: '../static/icons/loc.png',\r\n\t\t\t\t\twidth: 40,\r\n\t\t\t\t\theight: 40,\r\n\t\t\t\t}], // 标记点，用于显示起点、终点等\r\n\t\t\t\tpolyline: [{\r\n\t\t\t\t\tpoints: [],\r\n\t\t\t\t\tcolor: '#27ff6f',\r\n\t\t\t\t\twidth: 12,\r\n\t\t\t\t\tarrowLine: true\r\n\t\t\t\t}], // 折线，用于绘制跑步轨迹\r\n\t\t\t\ttimer:null,\r\n\t\t\t\tlastLocation: null,\r\n\t\t\t\tcurrentLocation: null,\r\n\t\t\t\tdistance: 0,\n\t\t\t};\n\t\t},\r\n\t\tmounted(){\r\n\t\t\tlet that=this;\r\n\t\t\tuni.getLocation({\r\n\t\t\t  type: 'gcj02', \r\n\t\t\t  success: function (res) {\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t\tconsole.log('当前位置的经度：' + res.longitude)\r\n\t\t\t\tconsole.log('当前位置的纬度：' + res.latitude)\r\n\t\t\t\tthat.latitude=res.latitude;\r\n\t\t\t\tthat.longitude=res.longitude;\r\n\t\t\t\tthat.markers[0].longitude = res.longitude;\r\n\t\t\t\tthat.markers[0].latitude = res.latitude;\r\n\t\t\t\tthat.markers[1].longitude = res.longitude;\r\n\t\t\t\tthat.markers[1].latitude = res.latitude;\r\n\t\t\t\tthat.lastLocation = { longitude: '', latitude: '' };\r\n\t\t\t\tthat.currentLocation = { longitude: res.longitude, latitude: res.latitude };\r\n\t\t\t  }, fail (error) {\r\n\t\t\t\tconsole.log('失败', error)\r\n\t\t\t  }\r\n\t\t\t})\r\n\t\t},\r\n\t\t methods: {\r\n\t\t\t//计算距离\r\n\t\t\tcalculateDistance(location1, location2) {\r\n\t\t\t\t  const EARTH_RADIUS = 6378137.0; // 地球半径，单位：米\r\n\t\t\t\t  const radLng1 = location1.longitude * Math.PI / 180.0;\r\n\t\t\t\t  const radLng2 = location2.longitude * Math.PI / 180.0;\r\n\t\t\t\t  const a = radLng1 - radLng2;\r\n\t\t\t\t  const b = (location1.latitude - location2.latitude) * Math.PI / 180.0;\r\n\t\t\t\t  let s = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(b / 2), 2) +\r\n\t\t\t\t\tMath.cos(location1.latitude * Math.PI / 180.0) * Math.cos(location2.latitude * Math.PI / 180.0) * Math.pow(Math.sin(a / 2), 2)));\r\n\t\t\t\t  s *= EARTH_RADIUS;\r\n\t\t\t\t  return s/1000;\r\n\t\t\t},\r\n\t\t    // 开始绘制路径\r\n\t\t    startDrawingPath() {\r\n\t\t\t\tlet that=this;\r\n\t\t\t\tconsole.log(\"开始\");\r\n\t\t      this.timer = setInterval(() => {\r\n\t\t        // 获取用户位置\r\n\t\t        uni.getLocation({\r\n\t\t          type: 'gcj02',\r\n\t\t          success: (res) => {\r\n\t\t            // 更新用户位置\r\n\t\t\t\t\tthat.longitude = res.longitude;\r\n\t\t\t\t\tthat.latitude = res.latitude;\r\n\t\t\t\t\tthat.markers[1].latitude=res.latitude;\r\n\t\t\t\t\tthat.markers[1].longitude=res.longitude;\r\n\t\t\t\t\tvar newPoint = {\r\n\t\t\t\t\t    longitude: that.longitude,\r\n\t\t\t\t\t    latitude: that.latitude\r\n\t\t\t\t\t}; \r\n\t\t\t\t\t// 添加路径点\r\n\t\t\t\t\tthat.polyline[0].points.push(newPoint);\r\n\t\t\t\t\tthat.currentLocation = { longitude: res.longitude, latitude: res.latitude };\r\n\t\t\t\t\tthat.updateDistance();\r\n\t\t\t\t\tlet data={}\r\n\t\t\t\t\tdata.distance=that.distance;\r\n\t\t\t\t\tdata.altitude=res.altitude;\r\n\t\t\t\t\tthat.$emit('update-distance', data);\r\n\t\t          }\r\n\t\t        });\t\t\t\t\t\t\t\t\t\r\n\t\t      }, 500);\r\n\t\t    },\r\n\t\t\tupdateDistance() {\r\n\t\t\t      if (this.lastLocation) {\r\n\t\t\t        const distance = this.calculateDistance(this.lastLocation, this.currentLocation);\r\n\t\t\t        this.distance += distance;\r\n\t\t\t      }\r\n\t\t\t      this.lastLocation = { longitude: this.currentLocation.longitude, latitude: this.currentLocation.latitude };\r\n\t\t\t},\r\n\t\t\tendSport(){\r\n\t\t\t\tthis.markers[1].iconPath='../../static/icons/end.png';\r\n\t\t\t\tthis.markers[0].iconPath='../../static/icons/start.png';\r\n\t\t\t\tlet data=[];\r\n\t\t\t\tdata.push(this.markers);\r\n\t\t\t\tdata.push(this.polyline);\r\n\t\t\t\treturn data;\r\n\t\t\t},\r\n\t\t\tstopDrawingPath() {\r\n\t\t\t\tclearInterval(this.timer);\r\n\t\t\t},\r\n\t\t}\n\t}\n</script>\n\n<style>\n\t\r\n\n</style>"],"sourceRoot":""}